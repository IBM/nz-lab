
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Loading and Unloading Data - Netezza Performance Server Lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#load-and-unloading-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Netezza Performance Server Lab" class="md-header__button md-logo" aria-label="Netezza Performance Server Lab" data-md-component="logo">
      
  <img src="../nz-images/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Netezza Performance Server Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Loading and Unloading Data
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Netezza Performance Server Lab" class="md-nav__button md-logo" aria-label="Netezza Performance Server Lab" data-md-component="logo">
      
  <img src="../nz-images/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    Netezza Performance Server Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-01-NPS-CLI/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-02-WebConsole/" class="md-nav__link">
        Web Console
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-03-Data-Distribution/" class="md-nav__link">
        Data Distribution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-04-Database-Admin/" class="md-nav__link">
        Database Administration
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Loading and Unloading Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Loading and Unloading Data
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-objectives" class="md-nav__link">
    1 Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-lab-environment" class="md-nav__link">
    2 Lab Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-connect-to-the-netezza-performance-server" class="md-nav__link">
    3 Connect to the Netezza Performance Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lab-setup" class="md-nav__link">
    4 Lab Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-external-tables" class="md-nav__link">
    5 External Tables
  </a>
  
    <nav class="md-nav" aria-label="5 External Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-unloading-data-using-external-tables" class="md-nav__link">
    5.1 Unloading Data using External Tables
  </a>
  
    <nav class="md-nav" aria-label="5.1 Unloading Data using External Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-unloading-data-with-an-external-table-created-with-the-sameas-clause" class="md-nav__link">
    5.1.1 Unloading data with an External Table created with the SAMEAS clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-unloading-data-with-an-external-table-using-the-as-select-clause" class="md-nav__link">
    5.1.2 Unloading data with an External Table using the AS SELECT clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-unloading-data-with-an-external-table-using-defined-columns" class="md-nav__link">
    5.1.3 Unloading data with an external table using defined columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-optional-unloading-data-with-an-external-table-from-two-tables" class="md-nav__link">
    5.1.4 (Optional) Unloading data with an External Table from two tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-optional-unloading-data-with-an-external-table-using-the-compress-format" class="md-nav__link">
    5.1.5 (Optional) Unloading data with an External Table using the compress format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-dropping-external-tables" class="md-nav__link">
    5.2 Dropping External Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-loading-data-using-external-tables" class="md-nav__link">
    5.3 Loading Data using External Tables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-loading-data-using-the-nzload-utility" class="md-nav__link">
    6 Loading Data using the nzload Utility
  </a>
  
    <nav class="md-nav" aria-label="6 Loading Data using the nzload Utility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-using-the-nzload-utility-with-command-line-options" class="md-nav__link">
    6.1 Using the nzload Utility with Command Line Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-using-the-nzload-utility-with-a-control-file" class="md-nav__link">
    6.2 Using the nzload Utility with a Control File.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-optional-using-nzload-with-bad-records" class="md-nav__link">
    6.3 (Optional) Using nzload with Bad Records
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-06-BNR/" class="md-nav__link">
        Backup and Restore
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-07-Query-Optimization/" class="md-nav__link">
        Query Optimization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-08-Optimization-Objects/" class="md-nav__link">
        Optimization Objects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-09-Groom/" class="md-nav__link">
        Grooming Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nz-10-Stored-Proc/" class="md-nav__link">
        Stored Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Appendix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendix" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nz-disclaimer/" class="md-nav__link">
        Disclaimer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nz-acknowledgements/" class="md-nav__link">
        Acknowledgements
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-objectives" class="md-nav__link">
    1 Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-lab-environment" class="md-nav__link">
    2 Lab Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-connect-to-the-netezza-performance-server" class="md-nav__link">
    3 Connect to the Netezza Performance Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lab-setup" class="md-nav__link">
    4 Lab Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-external-tables" class="md-nav__link">
    5 External Tables
  </a>
  
    <nav class="md-nav" aria-label="5 External Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-unloading-data-using-external-tables" class="md-nav__link">
    5.1 Unloading Data using External Tables
  </a>
  
    <nav class="md-nav" aria-label="5.1 Unloading Data using External Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-unloading-data-with-an-external-table-created-with-the-sameas-clause" class="md-nav__link">
    5.1.1 Unloading data with an External Table created with the SAMEAS clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-unloading-data-with-an-external-table-using-the-as-select-clause" class="md-nav__link">
    5.1.2 Unloading data with an External Table using the AS SELECT clause
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-unloading-data-with-an-external-table-using-defined-columns" class="md-nav__link">
    5.1.3 Unloading data with an external table using defined columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-optional-unloading-data-with-an-external-table-from-two-tables" class="md-nav__link">
    5.1.4 (Optional) Unloading data with an External Table from two tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-optional-unloading-data-with-an-external-table-using-the-compress-format" class="md-nav__link">
    5.1.5 (Optional) Unloading data with an External Table using the compress format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-dropping-external-tables" class="md-nav__link">
    5.2 Dropping External Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-loading-data-using-external-tables" class="md-nav__link">
    5.3 Loading Data using External Tables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-loading-data-using-the-nzload-utility" class="md-nav__link">
    6 Loading Data using the nzload Utility
  </a>
  
    <nav class="md-nav" aria-label="6 Loading Data using the nzload Utility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-using-the-nzload-utility-with-command-line-options" class="md-nav__link">
    6.1 Using the nzload Utility with Command Line Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-using-the-nzload-utility-with-a-control-file" class="md-nav__link">
    6.2 Using the nzload Utility with a Control File.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-optional-using-nzload-with-bad-records" class="md-nav__link">
    6.3 (Optional) Using nzload with Bad Records
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="load-and-unloading-data">Load and Unloading Data</h1>
<p>In every data warehouse environment, there is a need to load new data
into the database. The task to load data into the database is not just a
one-time operation but rather a continuous operation that can occur
hourly, daily, weekly, or even monthly. Loading data into the database
is a vital operation that needs to be supported by the data warehouse
system. Netezza Performance Server (NPS) provides a framework to support
not only the loading of data into the Netezza Performance Server
database environment, but also the unloading of data from the database
environment. This framework contains more than one component, some of
these components are:</p>
<p>External Tables - These are tables stored as flat files on the host or
client systems and registered like tables in the Netezza Performance
Server catalog. They can be used to load data into the Netezza
Performance Server or unload data to the file system.</p>
<p><code>nzload</code> - This is a wrapper command line tool around external tables
that provides an easy method loading data into the Netezza Performance
Server.</p>
<p>Format Options - These are options for formatting the data load to and
from external tables.</p>
<h2 id="1-objectives">1 Objectives</h2>
<p>This lab will help you explore the Netezza Performance Server framework
components for loading data into the database and unloading data from
the database. You will use the various commands to create external
tables to unload and load data. You will also get a basic understanding
of the nzload utility. In this lab the <code>REGION</code> and <code>NATION</code> tables in the
LABDB database are used to illustrate the use of external tables and the
nzload utility. After this lab you will have a good understanding on how
to load and unload data from a Netezza Performance Server database
environment</p>
<p>The first part of this lab will explore using External Tables to unload
and load data.</p>
<p>The second part of this lab will discuss using the nzload utility to
load records into tables.</p>
<h2 id="2-lab-environment">2 Lab Environment</h2>
<p>The lab system will be a virtual machine running on Virtual Box. Please
see the document on how to install the NPS Virtual Machine for your
workstation (Windows or Mac OS).</p>
<h2 id="3-connect-to-the-netezza-performance-server">3 Connect to the Netezza Performance Server</h2>
<p>Use the following information to connect to the virtual NPS system.
There are two options to access the command line:</p>
<ol>
<li>
<p>Login to the VM directly and use the terminal application available
    inside the VM.</p>
</li>
<li>
<p>Use the local terminal application on your workstation.</p>
</li>
</ol>
<p>The lab will use the command line as the nz user.</p>
<h2 id="4-lab-setup">4 Lab Setup</h2>
<p>This lab uses an initial setup script to make sure the correct user and
database exist for the remainder of the lab. Follow the instructions
below to run the setup script.</p>
<ol>
<li>
<p>Login to NPS Command Line using one of these two methods.</p>
<p>a.  Login to the VM directly and use the terminal application
    available inside the VM.</p>
<p>b.  Connect to your Netezza Performance Server image using a
    terminal application (Windows PowerShell, PuTTY, Mac OSX
    Terminal)</p>
</li>
<li>
<p>If you are continuing from the previous lab and are already
    connected to <code>nzsql</code> quit the <code>nzsql</code> console with the <code>\q</code> command.</p>
</li>
<li>
<p>Prepare for this lab by running the setup script. To do this use the
    following two commands:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Input</label><label for="__tabbed_1_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>cd ~/labs/movingData/setupLab
./setupLab.sh
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>DROP DATABASE
CREATE DATABASE
ERROR: CREATE USER: object LABADMIN already exists as a USER.
ALTER USER
ALTER DATABASE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
Load session of table &#39;NATION&#39; completed successfully
Load session of table &#39;REGION&#39; completed successfully
Load session of table &#39;CUSTOMER&#39; completed successfully
Load session of table &#39;SUPPLIER&#39; completed successfully
Load session of table &#39;PART&#39; completed successfully
</code></pre></div>
</div>
</div>
</div>
<p>The error message at the beginning is expected since the script tries
to clean up existing <code>LINEITEM</code> tables.</p>
</li>
</ol>
<h2 id="5-external-tables">5 External Tables</h2>
<p>An external table allows Netezza Performance Server to treat an external
file as a database table. An external table has a definition, a table
schema, in the Netezza Performance Server system catalog, but the actual
data exists outside of the Netezza Performance Server database. This is
referred to as a data source file. External tables can be used to access
files which are stored on a file system. After you have created the
external table definition, you can use <code>INSERT INTO</code> statements to load
data from the external file into a database table or <code>SELECT FROM</code>
statements to query the external table. Different methods are described
to create and use external tables using the nzsql interface. The
external data source files for the external tables will also be
examined, so a second session will be used to view these files.</p>
<p>Connect to your Netezza Performance Server image using a Terminal
application to ssh into <code>&lt;your-nps-vm-ip-address&gt;</code> (as <code>user nz</code> with
password <code>nz</code>). Alternatively, you can use a terminal application on the
virtual machine desktop.</p>
<p><code>&lt;your-nps-vm-ip-address&gt;</code> is the default IP address for a local VM, the
IP may be different for your session.</p>
<p>Change to the lab working directory <code>/home/nz/labs/movingData</code> using the
following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Input</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>cd /home/nz/labs/movingData
</code></pre></div>
</div>
</div>
</div>
<p>Connect to the <code>LABDB</code> database as the database owner, <code>LABADMIN</code>, using the
<code>nzsql</code> interface:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Input</label><label for="__tabbed_3_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzsql -d LABDB -u labadmin -pw password
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Welcome to nzsql, the IBM Netezza SQL interactive terminal.

Type: \h for help with SQL commands
\? for help on internal slash commands
\g or terminate with semicolon to execute query
\q to quit
</code></pre></div>
</div>
</div>
</div>
<p>In this lab we will need to alternatively execute SQL commands and
operating system commands. To make this task easier for you, we will
open a second Terminal session for executing operating system commands
like nzload, view generated external files etc. It will be referred to
as session 2 throughout the lab.</p>
<p><img alt="Image" src="../nz-images/nz-05-Loading-and-Unloading-Data/media/image5.png" /></p>
<p>The picture above shows the two Terminal windows that you will need.
Terminal 1, on the left, will be used for SQL commands and Terminal 2,
on the right, will be used for operating system prompt commands.</p>
<p>Open another session <code>[Terminal 2]</code> using PuTTY or a Terminal
Application.</p>
<p>Login to <code>&lt;your-nps-vm-ip-address&gt;</code> as user <code>nz</code> with password <code>nz</code>.</p>
<p>Change to the <code>/home/nz/labs/movingData</code> directory:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Input [Terminal 2]</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>cd /home/nz/labs/movingData
</code></pre></div>
</div>
</div>
</div>
<h3 id="51-unloading-data-using-external-tables">5.1 Unloading Data using External Tables</h3>
<p>External tables will be used to unload rows from the <code>LABDB</code> database as
records into an external datasource file. Various methods to create and
use external tables will be explored unloading rows from either <code>REGION</code>
or <code>NATION</code> tables. Five different basic use cases are presented for you
to follow so you can gain a better understanding of how to use external
tables to unload data from a database.</p>
<h4 id="511-unloading-data-with-an-external-table-created-with-the-sameas-clause">5.1.1 Unloading data with an External Table created with the SAMEAS clause</h4>
<p>The first external table will be used to unload data from the <code>REGION</code>
table into an ASCII delimited text file. This external table will be
named <code>ET1_REGION</code> using the same column definition as the <code>REGION</code> table.
After the <code>ET1_REGION</code> external table is created you will then use it to
unload all the rows from the <code>REGION</code> table. The records for the
<code>ET1_REGION</code> external table will be in the external datasource file,
et1_region_flat_file. The basic syntax to create this type of external
table is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE table_name
SAMEAS table_name
USING external_table_options
</code></pre></div>
</div>
</div>
</div>
<p>The <code>SAMEAS</code> clause allows the external table to be created with the same
column definition of the referenced table. This is referred to as
implicit schema definition.</p>
<p>As the <code>LABDB</code> database owner, <code>LABADMIN</code>, you will create the first basic
external table using the same column definitions as the <code>REGION</code> table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Input [Terminal 1]</label><label for="__tabbed_6_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>create external table et1_region sameas region using
(dataobject  (&#39;/home/nz/labs/movingData/et1_region_flat_file&#39;));
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE
</code></pre></div>
</div>
</div>
</div>
<p>Use the internal slash option <code>\dx</code> to list the external tables in the
LABDB database.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Input [Terminal 1]</label><label for="__tabbed_7_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\dx
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>             List of relations
 Schema |    Name    |      Type      |  Owner   
--------+------------+----------------+----------
 ADMIN  | ET1_REGION | EXTERNAL TABLE | LABADMIN
(1 row)
</code></pre></div>
</div>
</div>
</div>
<p>List the properties of the external table et1_region using the following
internal slash option to describe the table, <code>\d &lt;external table
name&gt;</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Input [Terminal 1]</label><label for="__tabbed_8_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\d et1_region
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>        External Table &quot;ET1_REGION&quot;
  Attribute  |          Type          | Modifier 
-------------+------------------------+----------
 R_REGIONKEY | INTEGER                | NOT NULL
 R_NAME      | CHARACTER(25)          | NOT NULL
 R_COMMENT   | CHARACTER VARYING(152) | 

DataObject - &#39;/home/nz/labs/movingData/et1_region_flat_file&#39;

adjustdistzeroint   - 
bool style          - 1_0
code set            - 
compress            - FALSE
cr in string        - 
ctrl chars          - 
date delim          - -
date style          - YMD
delim               - |
encoding            - INTERNAL
escape              - 
fill record         - 
format              - TEXT
ignore zero         - 
log dir             - /tmp
max errors          - 1
max rows            - 
null value          - NULL
quoted value        - NO
remote source       - 
require quotes      - 
skip rows           - 
socket buf size     - 8388608
timedelim           - :
time round nanos    - 
time style          - 24HOUR
trunc string        - 
y2base              - 
includezeroseconds  - 
record length       - 
record delimiter    - 

nullindicator bytes - 
layout              - 
decimaldelim        - 
disablenfc          - 
includeheader       - 
datetime delim      -  
meridian delim      -  
lfinstring          -
</code></pre></div>
</div>
</div>
</div>
<p>This output includes the columns and associated data types in the
external table. Notice that this is similar to the <code>REGION</code> table since
the external table was created using the <code>SAMEAS</code> clause in the <code>CREATE
EXTERNAL TABLE</code> command. The output also includes the properties of the
external table. The most notable property is the <code>DataObject</code> property
that shows the location and the name of the external datasource file
used for the external table. We will examine some of the others.</p>
<p>Now that the external table is created, use it to unload data from the
<code>REGION</code> table using an <code>INSERT</code> statement.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Input [Terminal 1]</label><label for="__tabbed_9_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>insert into et1_region select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
<p>Use the external table like a regular table by issuing SQL statements.
Try issuing a simple <code>SELECT FROM</code> statement to return all rows in
external table <code>ET1_REGION</code> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Input [Terminal 1]</label><label for="__tabbed_10_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from et1_region order by 1;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY |          R_NAME           |          R_COMMENT          
-------------+---------------------------+-----------------------------
           1 | na                        | north america
           2 | sa                        | south america
           3 | emea                      | europe, middle east, africa
           4 | ap                        | asia pacific
(4 rows)
</code></pre></div>
</div>
</div>
</div>
<p>You will notice that this is the same data that is in the <code>REGION</code> table.
But the data retrieved for this <code>SELECT</code> statement was from the datasource
of this external table and not from the data within the database.</p>
<p>The main reason for creating an external table is to unload data from a
table to a file. Using the second Putty (or Terminal) session, review
the file <code>et1_region_flat_file</code>. This is the file that was created in the
<code>/home/nz/labs/movingData</code> directory.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Input [Terminal 2]</label><label for="__tabbed_11_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more et1_region_flat_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>3|emea|europe, middle east, africa
1|na|north america
2|sa|south america
4|ap|asia pacific
</code></pre></div>
</div>
</div>
</div>
<p>This is an ASCII delimited flat file containing the data from the <code>REGION</code>
table. The column delimiter used in this file was the default character
'<code>|</code>'.</p>
<h4 id="512-unloading-data-with-an-external-table-using-the-as-select-clause">5.1.2 Unloading data with an External Table using the AS SELECT clause</h4>
<p>The second external table will be used to unload data from the <code>REGION</code>
table into an ASCII delimited text file using a different method. The
external table will be created and the data will be unloaded in the same
create statement. A separate step is not required to unload the data.
The external table will be named <code>ET2_REGION</code> and the external datasource
file will be named <code>et2_region_flat_file</code>. The basic syntax to create this
type of external table is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE table_name &#39;filename&#39; AS select_statement;
</code></pre></div>
</div>
</div>
</div>
<p>The <code>AS</code> clause allows the external table to be created with the same
columns returned in the <code>SELECT FROM</code> statement, which is referred to as
implicit table schema definition. This also unloads the rows at the same
time the external table is created.</p>
<p>The first method used to create an external table required the data to
be unloaded in a second step using an <code>INSERT</code> statement. Using the first
Putty (or Terminal) session, create an external table and unload the
data in a single step.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">Input [Terminal 1]</label><label for="__tabbed_13_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>create external table et2_region
&#39;/home/nz/labs/movingData/et2_region_flat_file&#39; as select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
<p>This command created the external table <code>ET2_REGION</code> using the same
definition as the <code>REGION</code> table and also unloaded the data to the
et2_region_flat_file.</p>
<p>Again, use <code>\dx</code> to list the external tables in the <code>LABDB</code> database.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">Input [Terminal 1]</label><label for="__tabbed_14_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\dx
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>                List of relations
 Schema |    Name    |      Type      |  Owner   
--------+------------+----------------+----------
 ADMIN  | ET1_REGION | EXTERNAL TABLE | LABADMIN
 ADMIN  | ET2_REGION | EXTERNAL TABLE | LABADMIN
(2 rows)
</code></pre></div>
</div>
</div>
</div>
<p>You will notice that there are now two external tables. You can also
list the properties of the external table. The output will be similar to
the output in the last section, except for the filename.</p>
<p>Using the second session, review the file that was created,
<code>et2_region_flat_file</code>, in the <code>/home/nz/labs/movingData directory</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">Input [Terminal 2]</label><label for="__tabbed_15_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more et2_region_flat_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>3|emea|europe, middle east, africa
1|na|north america
2|sa|south america
4|ap|asia pacific
</code></pre></div>
</div>
</div>
</div>
<p>This file is exactly the same as the file you reviewed in the last
chapter. The only difference in this example is we didn't need to unload
it explicitly.</p>
<h4 id="513-unloading-data-with-an-external-table-using-defined-columns">5.1.3 Unloading data with an external table using defined columns</h4>
<p>The first two external tables that you created used the exact same
columns from the <code>REGION</code> table using an implicit table schema. You can
also create an external table by explicitly specifying the columns. This
is referred to as an explicit table schema. The third external table
that you create will still be used to unload data from the <code>REGION</code> table
but only from the <code>R_NAME</code> and <code>R_COMMENT</code> columns. The <code>ET3_REGION</code> external
table will be created in one step and then the data will be unloaded
into the <code>et3_region_flat_file ASCII</code> delimited text file using a
different delimiter string. The basic syntax to create this type of
external table is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE table_name ({column_name type} [, ... ])
[USING external_table_options}]
</code></pre></div>
</div>
</div>
</div>
<ol>
<li>
<p>Create a new external table to only include the <code>R_NAME</code> and <code>R_COMMENT</code>
        columns and exclude the <code>R_REGIONKEY</code> column from the <code>REGION</code> table.
        Also change the delimiter string from the default '|' to '=':</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">Input [Terminal 1]</label><label for="__tabbed_17_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>create external table et3_region (r_name char(25),
r_comment varchar(152)) USING (dataobject
(&#39;/home/nz/labs/movingData/et3_region_flat_file&#39;) DELIMITER &#39;=&#39;);
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>List the properties of the <code>ET3_REGION</code> external table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">Input [Terminal 1]</label><label for="__tabbed_18_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\d et3_region
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>External Table &quot;ET3_REGION&quot;
 Attribute |          Type          | Modifier 
-----------+------------------------+----------
 R_NAME    | CHARACTER(25)          | 
 R_COMMENT | CHARACTER VARYING(152) | 

DataObject - &#39;/home/nz/labs/movingData/et3_region_flat_file&#39;

adjustdistzeroint   - 
bool style          - 1_0
code set            - 
compress            - FALSE
cr in string        - 
ctrl chars          - 
date delim          - -
date style          - YMD
delim               - =
encoding            - INTERNAL
escape              - 
fill record         - 
format              - TEXT
ignore zero         - 
log dir             - /tmp
max errors          - 1
max rows            - 
null value          - NULL
quoted value        - NO
remote source       - 
require quotes      - 
skip rows           - 
socket buf size     - 8388608
timedelim           - :
time round nanos    - 
time style          - 24HOUR
trunc string        - 
y2base              - 
includezeroseconds  - 
record length       - 
record delimiter    - 

nullindicator bytes - 
layout              - 
decimaldelim        - 
disablenfc          - 
includeheader       - 
datetime delim      -  
meridian delim      -  
lfinstring          - 
</code></pre></div>
</div>
</div>
</div>
<p>Notice that there are only two columns for this external table since
only two columns were specified when creating the external table. The
rest of the output is very similar to the properties of the other two
external tables that were created, with two main exceptions. The first
difference is the Dataobjects field, since the filename is different.
The other difference is the string used for the delimiter, since it is
now '=' instead of the default, '|'.</p>
</li>
<li>
<p>Unload the data from the <code>REGION</code> table but only the data from columns
        <code>R_NAME</code> and <code>R_COMMENT</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">Input [Terminal 1]</label><label for="__tabbed_19_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>insert into et3_region select r_name, r_comment from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
<p>Alternatively, you could have created the external table and unloaded
the data in one step using the following command:</p>
<div class="highlight"><pre><span></span><code>create external table et4_test
&#39;/home/nz/labs/movingData/et4_region_flat_file&#39; using (delimiter
&#39;=&#39;) as select r_name, r_comment from region;
</code></pre></div>
</li>
<li>
<p>Using the second session review the file that was created,
        <code>et3_region_flat_file</code>, in the <code>/home/nz/labs/movingData</code> directory.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">Input [Terminal 2]</label><label for="__tabbed_20_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more et3_region_flat_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>emea=europe, middle east, africa
na=north america
sa=south america
ap=asia pacific
</code></pre></div>
</div>
</div>
</div>
<p>Notice that only two columns are present in the flat file using the '='
string as a delimiter.</p>
</li>
</ol>
<h4 id="514-optional-unloading-data-with-an-external-table-from-two-tables">5.1.4 (Optional) Unloading data with an External Table from two tables</h4>
<p>The first three external table exercises unloaded data from one table.
In this exercise, the external table will be created based on a table
join between the <code>REGION</code> and <code>NATION</code> tables. The two tables will be joined
on the <code>REGIONKEY</code> and only the <code>N_NAME</code> and <code>R_NAME</code> columns will be defined
for the external table. This exercise will illustrate how data can be
unloaded using SQL statements other than a simple <code>SELECT FROM</code> statement.
The external table will be named <code>ET_NATION_REGION</code> using another ASCII
delimited text file named <code>et_nation_file_flat_file</code>.</p>
<ol>
<li>
<p>Unload data from both the <code>REGION</code> and <code>NATION</code> tables joined on the
    <code>REGIONKEY</code> column to list all of the countries and their associated
    regions. Instead of specifying the columns in the create external
    table statement you will use the <code>AS SELECT</code> option:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">Input [Terminal 2]</label><label for="__tabbed_21_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>create external table et_nation_region
&#39;/home/nz/labs/movingData/et_nation_region_flat_file&#39; as select
n_name, r_name from nation, region where n_regionkey=r_regionkey;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 14
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>List the properties of the ET_NATION_REGION external table.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><input id="__tabbed_22_2" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">Input [Terminal 1]</label><label for="__tabbed_22_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\d et_nation_region
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>  External Table &quot;ET_NATION_REGION&quot;
 Attribute |     Type      | Modifier 
-----------+---------------+----------
 N_NAME    | CHARACTER(25) | NOT NULL
 R_NAME    | CHARACTER(25) | NOT NULL

DataObject - &#39;/home/nz/labs/movingData/et_nation_region_flat_file&#39;

adjustdistzeroint   - 
bool style          - 1_0
code set            - 
compress            - FALSE
cr in string        - 
ctrl chars          - 
date delim          - -
date style          - YMD
delim               - |
encoding            - INTERNAL
escape              - 
fill record         - 
format              - TEXT
ignore zero         - 
log dir             - /tmp
max errors          - 1
max rows            - 
null value          - NULL
quoted value        - NO
remote source       - 
require quotes      - 
skip rows           - 
socket buf size     - 8388608
timedelim           - :
time round nanos    - 
time style          - 24HOUR
trunc string        - 
y2base              - 
includezeroseconds  - 
record length       - 
record delimiter    - 

nullindicator bytes - 
layout              - 
decimaldelim        - 
disablenfc          - 
includeheader       - 
datetime delim      -  
meridian delim      -  
lfinstring          - 
</code></pre></div>
</div>
</div>
</div>
<p>You will notice that the external table was created using the two
columns specified in the <code>SELECT</code> clause: <code>N_NAME</code> and <code>R_NAME</code>.</p>
</li>
<li>
<p>View the data of the <code>ET_NATION_REGION</code> external table.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:2"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><input id="__tabbed_23_2" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">Input [Terminal 1]</label><label for="__tabbed_23_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from et_nation_region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>          N_NAME           |          R_NAME           
---------------------------+---------------------------
 canada                    | na                       
 united states             | na                       
 brazil                    | sa                       
 guyana                    | sa                       
 venezuela                 | sa                       
 united kingdom            | emea                     
 portugal                  | emea                     
 united arab emirates      | emea                     
 south africa              | emea                     
 australia                 | ap                       
 japan                     | ap                       
 macau                     | ap                       
 hong kong                 | ap                       
 new zealand               | ap                       
(14 rows)
</code></pre></div>
</div>
</div>
</div>
<p>This is the result of the joining the <code>NATION</code> and <code>REGION</code> table on the
<code>REGIONKEY</code> column to return just the <code>N_NAME</code> and <code>R_NAME</code> columns.</p>
</li>
<li>
<p>Using the second session, review the file that was created,
        <code>et_nation_region_flat_file</code>, in the <code>/home/nz/labs/movingData</code>
        directory:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:2"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><input id="__tabbed_24_2" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">Input [Terminal 2]</label><label for="__tabbed_24_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more et_nation_region_flat_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>canada|na
united states|na
brazil|sa
guyana|sa
venezuela|sa
united kingdom|emea
portugal|emea
united arab emirates|emea
south africa|emea
australia|ap
japan|ap
macau|ap
hong kong|ap
new zealand|ap
</code></pre></div>
</div>
</div>
</div>
<p>We created a flat delimited flat file from a complex SQL statement.
External tables are a very flexible and powerful way to load, unload and
transfer data.</p>
</li>
</ol>
<h4 id="515-optional-unloading-data-with-an-external-table-using-the-compress-format">5.1.5 (Optional) Unloading data with an External Table using the compress format</h4>
<p>In the previous exercises, the external tables were created used the
default ASCII delimited text format. In this exercise, the external
table will be similar to the second external table that was created, but
instead of the using an ASCII delimited text format we will use the
compressed binary format. The name of the external table will be
<code>ET4_REGION</code> and the datasource file name will be <code>et4_region_compress</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:1"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>CREATE EXTERNAL TABLE table_name &#39;filename&#39; USING (COMPRESS true
FORMAT &#39;internal&#39;) AS select_statement;
</code></pre></div>
</div>
</div>
</div>
<ol>
<li>
<p>Create an external table using a similar method that you used to
        create the second external table, in section 2.1.2. But instead of
        using an ASCII delimited-text format, the datasource will use the
        compressed binary format. This is achieved by using the <code>COMPRESS</code> and
        <code>FORMAT</code> external table options:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:2"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><input id="__tabbed_26_2" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">Input [Terminal 1]</label><label for="__tabbed_26_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>create external table et4_region
&#39;/home/nz/labs/movingData/et4_region_compress&#39; using (compress true
format &#39;internal&#39;) as select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
<p>As a reminder, the external table is created, and the data is unloaded
in the same operation using the <code>AS SELECT</code> clause.</p>
</li>
<li>
<p>List the properties of the <code>ET4_REGION</code> external table</p>
<div class="tabbed-set tabbed-alternate" data-tabs="27:2"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><input id="__tabbed_27_2" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">Input [Terminal 1]</label><label for="__tabbed_27_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\d et4_region
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>           External Table &quot;ET4_REGION&quot;
  Attribute  |          Type          | Modifier 
-------------+------------------------+----------
 R_REGIONKEY | INTEGER                | NOT NULL
 R_NAME      | CHARACTER(25)          | NOT NULL
 R_COMMENT   | CHARACTER VARYING(152) | 

DataObject - &#39;/home/nz/labs/movingData/et4_region_compress&#39;

adjustdistzeroint   - 
bool style          - 
code set            - 
compress            - TRUE
cr in string        - 
ctrl chars          - 
date delim          - 
date style          - 
delim               - 
encoding            - 
escape              - 
fill record         - 
format              - INTERNAL
ignore zero         - 
log dir             - 
max errors          - 1
max rows            - 
null value          - 
quoted value        - 
remote source       - 
require quotes      - 
skip rows           - 
socket buf size     - 8388608
timedelim           - 
time round nanos    - 
time style          - 
trunc string        - 
y2base              - 
includezeroseconds  - 
record length       - 
record delimiter    - 
nullindicator bytes - 
layout              - 
decimaldelim        - 
disablenfc          - 
includeheader       - 
datetime delim      - 
meridian delim      - 
lfinstring          - 
</code></pre></div>
</div>
</div>
</div>
<p>Notice that the option for <code>COMPRESS</code> has changed from <code>FALSE</code> to <code>TRUE</code>
indicating that the datasource file is compressed, and the <code>FORMAT</code> has
changed from <code>TEXT</code> to <code>INTERNAL</code> which is required for compressed files.</p>
</li>
</ol>
<h3 id="52-dropping-external-tables">5.2 Dropping External Tables</h3>
<p>Dropping external tables is similar to dropping a regular Netezza
Performance Server table. The column definition for the external table
is removed from the Netezza Performance Server catalog. Keep in mind
that dropping the table doesn't delete the external datasource file so
they also have to be maintained, but the external datasource file can
still be used for loading data into a different table. In this exercise
you will drop the <code>ET1_REGION</code> table, but you will not delete the
associated external datasource file, <code>et1_region_flat_file</code>. This
datasource file will be used later in this lab to load data into the
<code>REGION</code> table.</p>
<ol>
<li>
<p>Drop the first external table that you created, <code>ET1_REGION</code>, using
        the <code>DROP TABLE</code> command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="28:2"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><input id="__tabbed_28_2" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">Input [Terminal 1]</label><label for="__tabbed_28_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>drop table et1_region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>DROP TABLE
</code></pre></div>
</div>
</div>
</div>
<p>The same drop command for tables is used for external tables. There is
not a separate <code>DROP EXTERNAL TABLE</code> command.</p>
</li>
<li>
<p>Verify the external table has been dropped using the internal slash
        option, <code>\dx</code>, to list all of the external tables.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="29:2"><input checked="checked" id="__tabbed_29_1" name="__tabbed_29" type="radio" /><input id="__tabbed_29_2" name="__tabbed_29" type="radio" /><div class="tabbed-labels"><label for="__tabbed_29_1">Input [Terminal 1]</label><label for="__tabbed_29_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>\dx
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>                 List of relations
 Schema |       Name       |      Type      |  Owner   
--------+------------------+----------------+----------
 ADMIN  | ET2_REGION       | EXTERNAL TABLE | LABADMIN
 ADMIN  | ET3_REGION       | EXTERNAL TABLE | LABADMIN
 ADMIN  | ET4_REGION       | EXTERNAL TABLE | LABADMIN
 ADMIN  | ET4_TEST         | EXTERNAL TABLE | LABADMIN
 ADMIN  | ET_NATION_REGION | EXTERNAL TABLE | LABADMIN
(5 rows)
</code></pre></div>
</div>
</div>
</div>
<p>Notice the remaining external tables that you created still exist.</p>
</li>
<li>
<p>Even though the external table definition no longer exists within
        the <code>LABDB</code> database, the flat file named <code>et1_region_flat_file</code> still
        exists in the <code>/home/nz/labs/movingData</code> directory. Verify this by
        using the second putty session:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="30:2"><input checked="checked" id="__tabbed_30_1" name="__tabbed_30" type="radio" /><input id="__tabbed_30_2" name="__tabbed_30" type="radio" /><div class="tabbed-labels"><label for="__tabbed_30_1">Input [Terminal 2]</label><label for="__tabbed_30_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>et1_region_flat_file et3_region_flat_file et4_region_flat_file
et2_region_flat_file et4_region_compress et_nation_region_flat_file
</code></pre></div>
</div>
</div>
</div>
<p>Notice that the file <code>et1_REGION_flat_file</code> still exists. This file can
still be used to load data into another similar table.</p>
</li>
</ol>
<h3 id="53-loading-data-using-external-tables">5.3 Loading Data using External Tables</h3>
<p>External tables can also be used to load data into tables in the
database. In this exercise, data will be loaded into the <code>REGION</code> table,
after first removing the existing rows. The method to load data from
external tables into a table is similar to using the DML <code>INSERT INTO</code> and
<code>SELECT FROM</code> statements. We will use two different methods to load data
into the <code>REGION</code> table, one using an external table and the other using
the external datasource file. Loading data into a table from any
external table will generate an associated log file with a default name
of <code>&lt;table_name&gt;.&lt;database_name&gt;.log</code></p>
<ol>
<li>
<p>Before loading the data into the <code>REGION</code> table, delete the rows from
    the data using the TRUNCATE TABLE command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="31:2"><input checked="checked" id="__tabbed_31_1" name="__tabbed_31" type="radio" /><input id="__tabbed_31_2" name="__tabbed_31" type="radio" /><div class="tabbed-labels"><label for="__tabbed_31_1">Input [Terminal 1]</label><label for="__tabbed_31_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>truncate table region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>TRUNCATE TABLE
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the table is empty with the <code>SELECT *</code> command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="32:2"><input checked="checked" id="__tabbed_32_1" name="__tabbed_32" type="radio" /><input id="__tabbed_32_2" name="__tabbed_32" type="radio" /><div class="tabbed-labels"><label for="__tabbed_32_1">Input [Terminal 1]</label><label for="__tabbed_32_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY | R_NAME | R_COMMENT 
-------------+--------+-----------
(0 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Load data into the <code>REGION</code> table from the <code>ET2_REGION</code> external table
    using an <code>INSERT</code> statement:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="33:2"><input checked="checked" id="__tabbed_33_1" name="__tabbed_33" type="radio" /><input id="__tabbed_33_2" name="__tabbed_33" type="radio" /><div class="tabbed-labels"><label for="__tabbed_33_1">Input [Terminal 1]</label><label for="__tabbed_33_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>insert into region select * from et2_region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Check to ensure that the table contains the four rows using the
        <code>SELECT *</code> statement.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="34:2"><input checked="checked" id="__tabbed_34_1" name="__tabbed_34" type="radio" /><input id="__tabbed_34_2" name="__tabbed_34" type="radio" /><div class="tabbed-labels"><label for="__tabbed_34_1">Input [Terminal 1]</label><label for="__tabbed_34_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY |          R_NAME           |          R_COMMENT          
-------------+---------------------------+-----------------------------
           3 | emea                      | europe, middle east, africa
           1 | na                        | north america
           2 | sa                        | south america
           4 | ap                        | asia pacific
(4 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Again, delete the rows in the <code>REGION</code> table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="35:2"><input checked="checked" id="__tabbed_35_1" name="__tabbed_35" type="radio" /><input id="__tabbed_35_2" name="__tabbed_35" type="radio" /><div class="tabbed-labels"><label for="__tabbed_35_1">Input [Terminal 1]</label><label for="__tabbed_35_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>truncate table region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>TRUNCATE TABLE
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Check to ensure that the table is empty using the <code>SELECT *</code>
        statement.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="36:2"><input checked="checked" id="__tabbed_36_1" name="__tabbed_36" type="radio" /><input id="__tabbed_36_2" name="__tabbed_36" type="radio" /><div class="tabbed-labels"><label for="__tabbed_36_1">Input [Terminal 1]</label><label for="__tabbed_36_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY | R_NAME | R_COMMENT 
-------------+--------+-----------
(0  rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Load data into the <code>REGION</code> table using the ASCII delimited file that
        was created for external table <code>ET1_REGION</code>. Recall that the
        definition of the external table was removed from that database, but
        the external data source file, <code>et1_region_flat_file</code>, still exists:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="37:2"><input checked="checked" id="__tabbed_37_1" name="__tabbed_37" type="radio" /><input id="__tabbed_37_2" name="__tabbed_37" type="radio" /><div class="tabbed-labels"><label for="__tabbed_37_1">Input [Terminal 1]</label><label for="__tabbed_37_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>insert into region select * from external
&#39;/labs/movingData/et1_region_flat_file&#39;;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>INSERT 0 4
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the table contains the four rows using the <code>SELECT *</code>
        statement.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="38:2"><input checked="checked" id="__tabbed_38_1" name="__tabbed_38" type="radio" /><input id="__tabbed_38_2" name="__tabbed_38" type="radio" /><div class="tabbed-labels"><label for="__tabbed_38_1">Input [Terminal 1]</label><label for="__tabbed_38_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY |          R_NAME           |          R_COMMENT          
-------------+---------------------------+-----------------------------
           3 | emea                      | europe, middle east, africa
           1 | na                        | north america
           2 | sa                        | south america
           4 | ap                        | asia pacific
(4 rows)
</code></pre></div>
</div>
</div>
</div>
<p>Since this is a load operation, there is always an associated log file
<code>&lt;table&gt;.&lt;database&gt;.nzlog</code> created for each load performed. By default
this log file is created in the <code>/tmp</code> directory.</p>
<p>In the second Putty session review this file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="39:2"><input checked="checked" id="__tabbed_39_1" name="__tabbed_39" type="radio" /><input id="__tabbed_39_2" name="__tabbed_39" type="radio" /><div class="tabbed-labels"><label for="__tabbed_39_1">Input [Terminal 2]</label><label for="__tabbed_39_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more /tmp/REGION.ADMIN.LABDB.nzlog
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load started at:08-May-13 07:10:13 EDT

  Database:        LABDB
  Tablename:       REGION
  Datafile:        /labs/movingData/etl_region_flat_file
  ...

Load Options

  Field delimiter:        &#39;|&#39;                  NULL value:            NULL
  File Buffer Size (MB):  8                    Load Replay Region (MB): 0

       Encoding:            INTERNAL        Max errors:             1
       Skip records:        0               Max rows:               0
       FillRecord:          No              Truncate String:        No
       Escape Char:         None            Accept Control Chars:   No
       Allow CR in string:  No              Ignore Zero:            No
       Quoted data:         NO              Require Quotes: No

       BoolStyle:           1_0             Decimal Delimiter:      &#39;.&#39;

       Disable NFC:         No      
       Date Style:          YMD             Date Delim:             &#39;-&#39;
       Time Style:          24HOUR          Time Delim:             &#39;:&#39;
       Time extra zeros:    No      


Statistics
 
   number of records read:      4
   number of bad records:       0
   number of records loaded:    4

   Elapsed Time (sec): 0.0
 
Load completed at: 08-May-13 07:10:13 EDT
</code></pre></div>
</div>
</div>
</div>
<p>Notice that the log file contains the load options and statistics of the
load, along with environment information to identify the table.</p>
</li>
</ol>
<h2 id="6-loading-data-using-the-nzload-utility">6 Loading Data using the nzload Utility</h2>
<p>The <code>nzload</code> command is a SQL CLI client application that allows you to
load data from the local host or a remote client, on all the supported
client platforms. The <code>nzload</code> command processes command-line load options
to send queries to the host to create an external table definition, runs
the insert/select query to load data, and when the load completes, drops
the external table. The <code>nzload</code> command is a command-line program that
accepts options from multiple sources, where some of the sources can be
from:</p>
<ul>
<li>
<p>Command line</p>
</li>
<li>
<p>Control file</p>
</li>
<li>
<p>NZ Environment Variables</p>
</li>
</ul>
<p>Without a control file, you can only do one load at a time. Using a
control file allows multiple loads. The <code>nzload</code> command connects to a
database with a username and password, just like any other Netezza
Performance Server client application. The username specifies an account
with a particular set of privileges, and the system uses this account to
verify access.</p>
<p>For this section of the lab you will continue to use the <code>LABADMIN</code> user
to load data into the <code>LABDB</code> database. The nzload utility will be used to
load records from an external datasource file into the <code>REGION</code> table. The
nzload log files will be reviewed to examine the nzload options. Since
you will be loading data into a populated <code>REGION</code> table, you will use the
<code>TRUNCATE TABLE</code> command to remove the rows from the table.</p>
<p>We will continue to use the two putty sessions from the external table
lab.</p>
<p>Session One, which is connected to the NZSQL console to execute SQL
commands, for example to review tables after load operations</p>
<p>Session Two, which will be used for operating system commands such as
execute nzload.</p>
<h3 id="61-using-the-nzload-utility-with-command-line-options">6.1 Using the nzload Utility with Command Line Options</h3>
<p>The first method for using the nzload utility to load data in the <code>REGION</code>
table will specify options at the command line. We will only need to
specify the datasource file and we will use default options for the
rest. The datasource file will be the et1_region_flat_file that you
created in the External Tables section.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="40:1"><input checked="checked" id="__tabbed_40_1" name="__tabbed_40" type="radio" /><div class="tabbed-labels"><label for="__tabbed_40_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db &lt;database&gt; -u &lt;username&gt; -pw &lt;password&gt; -df &lt;datasource filename&gt;
</code></pre></div>
</div>
</div>
</div>
<ol>
<li>
<p>As the <code>LABDB</code> database owner, <code>LABADMIN</code> first remove the rows in the
        <code>REGION</code> table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="41:2"><input checked="checked" id="__tabbed_41_1" name="__tabbed_41" type="radio" /><input id="__tabbed_41_2" name="__tabbed_41" type="radio" /><div class="tabbed-labels"><label for="__tabbed_41_1">Input [Terminal 1]</label><label for="__tabbed_41_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>truncate table region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>TRUNCATE TABLE
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the rows have been removed from the table using the <code>SELECT *</code>
        statement:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="42:2"><input checked="checked" id="__tabbed_42_1" name="__tabbed_42" type="radio" /><input id="__tabbed_42_2" name="__tabbed_42" type="radio" /><div class="tabbed-labels"><label for="__tabbed_42_1">Input [Terminal 1]</label><label for="__tabbed_42_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY | R_NAME | R_COMMENT 
-------------+--------+-----------
(0 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Using the second session at the OS command line, use the nzload
        utility to load data.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="43:1"><input checked="checked" id="__tabbed_43_1" name="__tabbed_43" type="radio" /><div class="tabbed-labels"><label for="__tabbed_43_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>-db &lt;database name&gt;, -u &lt;user&gt;, -pw &lt;password&gt;, -t &lt;table name&gt;,
-df &lt;data file&gt;, and -delimiter &lt;string&gt;:
</code></pre></div>
</div>
</div>
</div>
<p>The following command will load data from the <code>et1_region_flat_file</code> into the <code>REGION</code>
    table using the following command line options:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="44:2"><input checked="checked" id="__tabbed_44_1" name="__tabbed_44" type="radio" /><input id="__tabbed_44_2" name="__tabbed_44" type="radio" /><div class="tabbed-labels"><label for="__tabbed_44_1">Input [Terminal 2]</label><label for="__tabbed_44_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db labdb -u labadmin -pw password 
-t region -df et1_region_flat_file -delimiter &#39;|&#39;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load session of table &#39;REGION&#39; completed successfully
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the rows have been load into the table by using the <code>SELECT *</code>
        statement:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="45:2"><input checked="checked" id="__tabbed_45_1" name="__tabbed_45" type="radio" /><input id="__tabbed_45_2" name="__tabbed_45" type="radio" /><div class="tabbed-labels"><label for="__tabbed_45_1">Input [Terminal 1]</label><label for="__tabbed_45_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY |          R_NAME           |          R_COMMENT          
-------------+---------------------------+-----------------------------
           3 | emea                      | europe, middle east, africa
           1 | na                        | north america
           2 | sa                        | south america
           4 | ap                        | asia pacific
(4 rows)
</code></pre></div>
</div>
</div>
</div>
<p>These rows were loaded into the <code>REGION</code> table from the records in the
<code>et1_region_flat_file</code> file.</p>
</li>
<li>
<p>For every load task performed there is always an associated log
    file created with the format <code>&lt;table&gt;.&lt;db&gt;.nzlog</code>. By default, this
    log file is created in the current working directory, which is the
    <code>/home/nz/labs/movingData</code> directory. In the second session review this
    file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="46:2"><input checked="checked" id="__tabbed_46_1" name="__tabbed_46" type="radio" /><input id="__tabbed_46_2" name="__tabbed_46" type="radio" /><div class="tabbed-labels"><label for="__tabbed_46_1">Input [Terminal 2]</label><label for="__tabbed_46_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more REGION.ADMIN.LABDB.nzlog
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load started at:03-Apr-20 03:05:12 PDT

  Database:         LABDB
  Schema:           ADMIN
  Tablename:        REGION
  Datafile:         /home/nz/labs/movingData/et1_region_flat_file
  Host:             localhost.localdomain

Load Options

  Field delimiter:       &#39;|&#39;                NULL value:            NULL
  File Buffer Size (MB): 8                  Load Replay Region (MB): 0
  Encoding:              INTERNAL           Max errors:            1
  Skip records:          0                  Max rows:              0
  FillRecord:            No                 Truncate String:       No
  Escape Char:           None               Accept Control Chars:  No
  Allow CR in string:    No                 Ignore Zero:           No
  Quoted data:           NO                 Require Quotes:        No

  BoolStyle:             1_0                Decimal Delimiter:     &#39;.&#39;

  Disable NFC:           No               
  Date Style:            YMD                Date Delim:            &#39;-&#39;
  DateTime Delim:        &#39; &#39;
  Time Style:            24HOUR             Time Delim:            &#39;:&#39;
  Record Delim:          &#39;\n&#39;               Meridian Delim:        &#39; &#39;
  Time extra zeros:      No                 LfInString:            False            

Statistics

  number of records read:      4
  number of bytes read:        91
  number of bad records:       0
  -------------------------------------------------
  number of records loaded:    4

  Elapsed Time (sec): 0.0


-----------------------------------------------------------------------------
Load completed at: 03-Apr-20 03:05:12 PDT 
=============================================================================
</code></pre></div>
</div>
</div>
</div>
<p>Notice the log file contains the load options and statistics of the
load, along with environment information to identify the database and
table.</p>
<p>The <code>-db</code>, <code>-u</code>, and <code>-pw</code> options specify the database name, the user, and
the password respectively. Alternatively, you could omit these options
if the NZ environment variables are set to the appropriate database,
username and password values. Since the NZ environment variables,
<code>NZ_DATABASE</code>, <code>NZ_USER</code>, and <code>NZ_PASSWORD</code> are set to system, admin, and
password, we will need to use these options so the load will use the
<code>LABDB</code> database and the <code>LABADMIN</code> user.</p>
<p>There are other options that you can use with the nzload utility. These
options were not specified here since the default values were sufficient
for this load task.</p>
<ul>
<li>
<p><code>-t</code> specifies the target table name in the database</p>
</li>
<li>
<p><code>-df</code> specifies the datasource file to be loaded</p>
</li>
<li>
<p><code>-delimiter</code> specifies the string to use as the delimiter in an ASCII
delimited text file.</p>
</li>
</ul>
<p>The following <code>nzload</code> command syntax is equivalent to the <code>nzload</code> command
we used above. It is intended to demonstrate some of the options that
can be used with the <code>nzload</code> command, or can be omitted when default
values are acceptable.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="47:1"><input checked="checked" id="__tabbed_47_1" name="__tabbed_47" type="radio" /><div class="tabbed-labels"><label for="__tabbed_47_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db labdb -u labadmin -pw password
-t region
-df et1_region_flat_file -delimiter &#39;|&#39;
-outputDir &#39;&lt;current directory&gt;&#39;
-lf &lt;table&gt;.&lt;database&gt;.nzlog -bf&lt;table&gt;.&lt;database&gt;.nzlog
-compress false -format text
-maxErrors 1
</code></pre></div>
</div>
</div>
</div>
<p>The <code>-lf</code>, <code>-bf</code>, and <code>-maxErrors</code> options are explained in the next
exercise. The <code>-compress</code> and <code>-format</code> options indicate that the
datasource file is an ASCII delimited text file. For a compressed binary
datasource file the following options would be used: <code>-compress true
-format internal</code>.</p>
</li>
</ol>
<h3 id="62-using-the-nzload-utility-with-a-control-file">6.2 Using the nzload Utility with a Control File.</h3>
<p>As demonstrated in section 3.1 you can run the nzload command by
specifying the command line options or you can use another method by
specifying the options in a file, referred to as a control file. This is
useful because the file can be modified over time, since loading data
into a database for a data warehouse environment is a continuous
operation. A nzload control file has the following basic structure:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="48:1"><input checked="checked" id="__tabbed_48_1" name="__tabbed_48" type="radio" /><div class="tabbed-labels"><label for="__tabbed_48_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>DATAFILE &lt;filename&gt;
{
[&lt;option name&gt; &lt;option value&gt;]
}
</code></pre></div>
</div>
</div>
</div>
<p>The <code>-cf</code> option is used at the <code>nzload</code> command line to indicate the use
of a control file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="49:1"><input checked="checked" id="__tabbed_49_1" name="__tabbed_49" type="radio" /><div class="tabbed-labels"><label for="__tabbed_49_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -u &lt;username&gt; -pw &lt;password&gt; -cf &lt;control file&gt;
</code></pre></div>
</div>
</div>
</div>
<p>The <code>-u</code> and <code>-pw</code> options are optional if the <code>NZ_USER</code> and <code>NZ_PASSWORD</code>
environment variables are set to the appropriate user and password.
Using the <code>-u</code> and <code>-pw</code> options overrides the values in the NZ
environment variables.</p>
<p>In this session you will load rows into an empty <code>REGION</code> table using the
nzload utility with a control file. The control file will set the
following options: delimiter, logDir, logFile, and badFile, along with
the database and table name. The datasource file to be used in this
session is the <code>region.del</code> file.</p>
<ol>
<li>
<p>As the <code>LABDB</code> database owner, <code>LABADMIN</code> first remove the rows in the
        <code>REGION</code> table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="50:2"><input checked="checked" id="__tabbed_50_1" name="__tabbed_50" type="radio" /><input id="__tabbed_50_2" name="__tabbed_50" type="radio" /><div class="tabbed-labels"><label for="__tabbed_50_1">Input [Terminal 1]</label><label for="__tabbed_50_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>truncate table region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>TRUNCATE TABLE
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the rows have been removed from the table using the <code>SELECT
    *</code> statement. The table should contain no rows.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="51:2"><input checked="checked" id="__tabbed_51_1" name="__tabbed_51" type="radio" /><input id="__tabbed_51_2" name="__tabbed_51" type="radio" /><div class="tabbed-labels"><label for="__tabbed_51_1">Input [Terminal 1]</label><label for="__tabbed_51_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code> R_REGIONKEY | R_NAME | R_COMMENT 
-------------+--------+-----------
(0 rows)
</code></pre></div>
</div>
</div>
</div>
<p>The control file will be used by the nzload utility to load data into
the <code>REGION</code> table using the <code>region.del</code> data file. The control file has
already been created in the lab directory. A control file can include
the following options:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>Database name</td>
</tr>
<tr>
<td>Tablename</td>
<td>Table name</td>
</tr>
<tr>
<td>Delimiter</td>
<td>Delimiter string</td>
</tr>
<tr>
<td>LogDir</td>
<td>Log directory</td>
</tr>
<tr>
<td>LogFile</td>
<td>Log file name</td>
</tr>
<tr>
<td>BadFile</td>
<td>Bad record log file name</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Review the control file in the second putty session with the
        following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="52:2"><input checked="checked" id="__tabbed_52_1" name="__tabbed_52" type="radio" /><input id="__tabbed_52_2" name="__tabbed_52" type="radio" /><div class="tabbed-labels"><label for="__tabbed_52_1">Input [Terminal 2]</label><label for="__tabbed_52_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more control_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>DATAFILE /home/nz/labs/movingData/region.del
{
        Database        labdb
        Tablename       region
        Delimiter       &#39;|&#39;
        LogDir          &#39;/home/nz/labs/movingData&#39;
        LogFile         region.log
        BadFile         region.bad
}
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Load the data using the nzload utility and the control file you just
        reviewed.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="53:2"><input checked="checked" id="__tabbed_53_1" name="__tabbed_53" type="radio" /><input id="__tabbed_53_2" name="__tabbed_53" type="radio" /><div class="tabbed-labels"><label for="__tabbed_53_1">Input [Terminal 2]</label><label for="__tabbed_53_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -u labadmin -pw password -cf control_file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load session of table &#39;REGION&#39; completed successfully
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>The <code>nzload</code> log file was renamed using the information in the control
        file. The log file name was changed from the default to region.log
        and the location was changed from the <code>/tmp</code> directory to <code>/labs/</code>.
        Check the <code>nzload</code> log.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="54:2"><input checked="checked" id="__tabbed_54_1" name="__tabbed_54" type="radio" /><input id="__tabbed_54_2" name="__tabbed_54" type="radio" /><div class="tabbed-labels"><label for="__tabbed_54_1">Input [Terminal 2]</label><label for="__tabbed_54_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more region.log
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load started at:03-Apr-20 03:38:32 PDT

  Database:         LABDB
  Schema:           ADMIN
  Tablename:        REGION
  Datafile:         /home/nz/labs/movingData/region.del
  Host:             localhost.localdomain

Load Options

  Field delimiter:       &#39;|&#39;                NULL value:            NULL
  File Buffer Size (MB): 8                  Load Replay Region (MB): 0
  Encoding:              INTERNAL           Max errors:            1
  Skip records:          0                  Max rows:              0
  FillRecord:            No                 Truncate String:       No
  Escape Char:           None               Accept Control Chars:  No
  Allow CR in string:    No                 Ignore Zero:           No
  Quoted data:           NO                 Require Quotes:        No

  BoolStyle:             1_0                Decimal Delimiter:     &#39;.&#39;

  Disable NFC:           No               
  Date Style:            YMD                Date Delim:            &#39;-&#39;
  DateTime Delim:        &#39; &#39;
  Time Style:            24HOUR             Time Delim:            &#39;:&#39;
  Record Delim:          &#39;\n&#39;               Meridian Delim:        &#39; &#39;
  Time extra zeros:      No                 LfInString:            False            

Statistics

  number of records read:      4
  number of bytes read:        91
  number of bad records:       0
  -------------------------------------------------
  number of records loaded:    4

  Elapsed Time (sec): 0.0


-----------------------------------------------------------------------------
Load completed at: 03-Apr-20 03:38:32 PDT 
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the rows in the <code>REGION</code> table in the first putty session with
        the nzsql console:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="55:2"><input checked="checked" id="__tabbed_55_1" name="__tabbed_55" type="radio" /><input id="__tabbed_55_2" name="__tabbed_55" type="radio" /><div class="tabbed-labels"><label for="__tabbed_55_1">Input [Terminal 1]</label><label for="__tabbed_55_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from region;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>R_REGIONKEY |          R_NAME           |          R_COMMENT          
-------------+---------------------------+-----------------------------
           3 | emea                      | europe, middle east, africa
           1 | na                        | north america
           2 | sa                        | south america
           4 | ap                        | asia pacific
(4 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
</ol>
<h3 id="63-optional-using-nzload-with-bad-records">6.3 (Optional) Using nzload with Bad Records</h3>
<p>The first two load methods illustrated how to use the <code>nzload</code> utility to
load data into an empty table using command line options or a control
file. In a data warehousing environment, most of the time data is
incrementally added to a table already containing some rows.</p>
<p>There will be instances where records from a datasource might not match
the datatypes in the table. When this occurs, the load will abort when
the first bad record is encountered. This is the default behavior and is
controlled by the maxErrors option, which is set to a default value of
1.</p>
<p>For this exercise we will add additional rows to the <code>NATION</code> table. Since
we will be adding rows to the <code>NATION</code> table, there will be no need to
truncate the table. The datasource file we will be using is the
nation.del file, which unfortunately has a bad record.</p>
<ol>
<li>
<p>First check the <code>NATION</code> table by listing all of the rows in the table
        using the <code>SELECT *</code> statement in the first putty session:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="56:2"><input checked="checked" id="__tabbed_56_1" name="__tabbed_56" type="radio" /><input id="__tabbed_56_2" name="__tabbed_56" type="radio" /><div class="tabbed-labels"><label for="__tabbed_56_1">Input [Terminal 1]</label><label for="__tabbed_56_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from nation;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>N_NATIONKEY |          N_NAME           | N_REGIONKEY |            N_COMMENT             
-------------+---------------------------+-------------+----------------------------------
           1 | canada                    |           1 | canada
           2 | united states             |           1 | united states of america
           3 | brazil                    |           2 | brasil
           4 | guyana                    |           2 | guyana
           5 | venezuela                 |           2 | venezuela
           6 | united kingdom            |           3 | united kingdom
           7 | portugal                  |           3 | portugal
           8 | united arab emirates      |           3 | al imarat al arabiyah multahidah
           9 | south africa              |           3 | south africa
          10 | australia                 |           4 | australia
          11 | japan                     |           4 | nippon
          12 | macau                     |           4 | aomen
          13 | hong kong                 |           4 | xianggang
          14 | new zealand               |           4 | new zealand
(14 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Using the second session at the OS command line you will use the
        <code>nzload</code> utility to load data from the nation.del file into the
        <code>NATION</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="57:2"><input checked="checked" id="__tabbed_57_1" name="__tabbed_57" type="radio" /><input id="__tabbed_57_2" name="__tabbed_57" type="radio" /><div class="tabbed-labels"><label for="__tabbed_57_1">Input [Terminal 1]</label><label for="__tabbed_57_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db LABDB -u labadmin -pw password -t nation -df nation.del -delimiter &#39;|&#39;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Error: Operation canceled
Error: External Table : count of bad input rows reached maxerrors limit
See /home/nz/labs/movingData/NATION.ADMIN.LABDB.nzlog file
Error: Load Failed, records not inserted.
</code></pre></div>
</div>
</div>
</div>
<p>This is an indication that the load has failed due to a bad record in
the datasource file.</p>
</li>
<li>
<p>Since the load has failed no rows were loaded into the <code>NATION</code> table,
        which you can confirm by using the <code>SELECT *</code> statement (in the first
        session):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="58:2"><input checked="checked" id="__tabbed_58_1" name="__tabbed_58" type="radio" /><input id="__tabbed_58_2" name="__tabbed_58" type="radio" /><div class="tabbed-labels"><label for="__tabbed_58_1">Input [Terminal 1]</label><label for="__tabbed_58_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from nation;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>N_NATIONKEY |          N_NAME           | N_REGIONKEY |            N_COMMENT             
-------------+---------------------------+-------------+----------------------------------
           1 | canada                    |           1 | canada
           2 | united states             |           1 | united states of america
           3 | brazil                    |           2 | brasil
           4 | guyana                    |           2 | guyana
           5 | venezuela                 |           2 | venezuela
           6 | united kingdom            |           3 | united kingdom
           7 | portugal                  |           3 | portugal
           8 | united arab emirates      |           3 | al imarat al arabiyah multahidah
           9 | south africa              |           3 | south africa
          10 | australia                 |           4 | australia
          11 | japan                     |           4 | nippon
          12 | macau                     |           4 | aomen
          13 | hong kong                 |           4 | xianggang
          14 | new zealand               |           4 | new zealand
(14 rows)
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>In the second session, check the log file to determine the problem:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="59:2"><input checked="checked" id="__tabbed_59_1" name="__tabbed_59" type="radio" /><input id="__tabbed_59_2" name="__tabbed_59" type="radio" /><div class="tabbed-labels"><label for="__tabbed_59_1">Input [Terminal 2]</label><label for="__tabbed_59_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more NATION.ADMIN.LABDB.nzlog
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load started at:03-Apr-20 04:31:19 PDT

  Database:         LABDB
  Schema:           ADMIN
  Tablename:        NATION
  Datafile:         &lt;stdin&gt;
  Host:             localhost.localdomain

Load Options

  Field delimiter:       &#39;\t&#39;               NULL value:            NULL
  File Buffer Size (MB): 8                  Load Replay Region (MB): 0
  Encoding:              INTERNAL           Max errors:            1
  Skip records:          0                  Max rows:              0
  FillRecord:            No                 Truncate String:       No
  Escape Char:           None               Accept Control Chars:  No
  Allow CR in string:    No                 Ignore Zero:           No
  Quoted data:           NO                 Require Quotes:        No

  BoolStyle:             1_0                Decimal Delimiter:     &#39;.&#39;

  Disable NFC:           No               
  Date Style:            YMD                Date Delim:            &#39;-&#39;
  DateTime Delim:        &#39; &#39;
  Time Style:            24HOUR             Time Delim:            &#39;:&#39;
  Record Delim:          &#39;\n&#39;               Meridian Delim:        &#39; &#39;
  Time extra zeros:      No                 LfInString:            False            

Load started at:03-Apr-20 04:36:02 PDT

  Database:         LABDB
  Schema:           ADMIN
  Tablename:        NATION
  Datafile:         /home/nz/labs/movingData/nation.del
  Host:             localhost.localdomain

Load Options

  Field delimiter:       &#39;|&#39;                NULL value:            NULL
  File Buffer Size (MB): 8                  Load Replay Region (MB): 0
  Encoding:              INTERNAL           Max errors:            1
  Skip records:          0                  Max rows:              0
  FillRecord:            No                 Truncate String:       No
  Escape Char:           None               Accept Control Chars:  No
  Allow CR in string:    No                 Ignore Zero:           No
  Quoted data:           NO                 Require Quotes:        No

  BoolStyle:             1_0                Decimal Delimiter:     &#39;.&#39;

  Disable NFC:           No               
  Date Style:            YMD                Date Delim:            &#39;-&#39;
  DateTime Delim:        &#39; &#39;
  Time Style:            24HOUR             Time Delim:            &#39;:&#39;
  Record Delim:          &#39;\n&#39;               Meridian Delim:        &#39; &#39;
  Time extra zeros:      No                 LfInString:            False            

Found bad records

bad #: input row #(byte offset to last char examined) [field #, declaration] diagnostic, &quot;text consumed&quot;[last char examined]
----------------------------------------------------------------------------------------------------------------------------
1: 10(1) [1, INT4] expected field delimiter or end of record, &quot;2&quot;[t]

Statistics

  number of records read:      10
  number of bytes read:        226
  number of bad records:       1
  -------------------------------------------------
  number of records loaded:    0

  Elapsed Time (sec): 0.0


-----------------------------------------------------------------------------
Load completed at: 03-Apr-20 04:36:02 PDT 
=============================================================================
</code></pre></div>
</div>
</div>
</div>
<p>The Statistics section indicates that 10 records were read before the
bad record was encountered during the load process. As expected, no rows
were inserted into the table since the default is to abort the load when
one bad record is encountered. The log file also provides information
about the bad record:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="60:1"><input checked="checked" id="__tabbed_60_1" name="__tabbed_60" type="radio" /><div class="tabbed-labels"><label for="__tabbed_60_1">Sample Syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Found bad records

bad #: input row #(byte offset to last char examined) [field #, declaration] diagnostic, &quot;text consumed&quot;[last char examined]
----------------------------------------------------------------------------------------------------------------------------
1: 10(1) [1, INT4] expected field delimiter or end of record, &quot;2&quot;[t]
</code></pre></div>
</div>
</div>
</div>
<p>Using the log file, we are able to determine the problem is that the
value '2t' is in a field for an <code>INT(4)</code> column. Since '2t' is not a valid
integer, the load marked this as a bad record</p>
<p><code>10(1)</code> indicates the input record number within the file and the offset
within the row where a problem was encountered. For this example, the
input record is <code>10</code> and offset is <code>1</code>.</p>
<p><code>[1, INT(4)]</code> indicates the column number within the row and the data
for the column. For this example, the column number is 1 and the data
type is <code>INT(4)</code>.</p>
<p><code>"2"[t]</code> indicates the character that caused the problem. For this
example, the character is <code>2t</code>.</p>
</li>
<li>
<p>We can verify our problem determination for the load failure is
        correct by examining the <code>nation.del</code> datasource file that was used
        for the load. In the second session execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="61:2"><input checked="checked" id="__tabbed_61_1" name="__tabbed_61" type="radio" /><input id="__tabbed_61_2" name="__tabbed_61" type="radio" /><div class="tabbed-labels"><label for="__tabbed_61_1">Input [Terminal 2]</label><label for="__tabbed_61_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more nation.del
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>15|andorra|2|andorra
16|ascension islan|3|ascension
17|austria|3|osterreich
18|bahamas|2|bahamas
19|barbados|2|barbados
20|belgium|3|belqique
21|chile|2|chile
22|cuba|2|cuba
23|cook islands|4|cook islands
2t|denmark|3|denmark
25|ecuador|2|ecuador
26|falkland islands|3|islas malinas
27|fiji|4|fiji
28|finland|3|suomen tasavalta
29|greenland|1|kalaallit nunaat
30|great britain|3|great britian
31|gibraltar|3|gibraltar
32|hungary|3|magyarorszag
33|iceland|3|lyoveldio island
34|ireland|3|eire
35|isle of man|3|isle of man
36|jamaica|2|jamaica
37|korea|4|han-guk
38|luxembourg|3|Luxembourg
</code></pre></div>
</div>
</div>
</div>
<p>Notice on the 10th line the output. There is indeed an invalid <code>2t</code> in the
first column of the input file. Therefore, we made the correct
assumption that the '2t' is causing the problem. From this list you can
assume that the correct value should be <code>24</code>.</p>
</li>
<li>
<p>Alternatively, we could have examined the nzload bad log file
        <code>NATION.LABDB.nzbad</code>, which will contain all bad records that are
        encountered during a load. In the second session execute the
        following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="62:2"><input checked="checked" id="__tabbed_62_1" name="__tabbed_62" type="radio" /><input id="__tabbed_62_2" name="__tabbed_62" type="radio" /><div class="tabbed-labels"><label for="__tabbed_62_1">Input [Terminal 2]</label><label for="__tabbed_62_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more NATION.ADMIN.LABDB.nzbad
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>2t|denmark|3|Denmark
</code></pre></div>
</div>
</div>
</div>
<p>This is the same data as identified in the <code>nation.del</code> file and using the
log file information to locate the record. Since the default is to stop
the load after the first bad record is processed there is only one row
in the bad log file. If we were to change the default behavior to allow
more bad records to be processed, this file could potentially contain
more records. It provides a comfortable overview of all the records that
created exceptions during load.</p>
</li>
<li>
<p>We have the option of changing the <code>NATION.del</code> file to change '2t' to
        '24' and then rerun the same <code>nzload</code> command as in step 7. Instead
        you will rerun a similar load but you will allow 10 bad records to
        be encountered during the load process. To change the default
        behavior, you need to use the command option <code>-maxErrors</code>. You will
        also change the name of the nzbad file using the <code>-bf</code> command option
        and the log filename using the <code>-lf</code> command option:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="63:2"><input checked="checked" id="__tabbed_63_1" name="__tabbed_63" type="radio" /><input id="__tabbed_63_2" name="__tabbed_63" type="radio" /><div class="tabbed-labels"><label for="__tabbed_63_1">Input [Terminal 2]</label><label for="__tabbed_63_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db labdb -u labadmin -pw password -t nation -df nation.del -delimiter &#39;|&#39; -maxerrors 10 -bf nation.bad -lf nation.log
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load session of table &#39;NATION&#39; completed successfully
</code></pre></div>
</div>
</div>
</div>
<p>Now the load is successful.</p>
</li>
<li>
<p>Verify the newly loaded rows are in the <code>NATION</code> using the <code>SELECT *</code>
        command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="64:2"><input checked="checked" id="__tabbed_64_1" name="__tabbed_64" type="radio" /><input id="__tabbed_64_2" name="__tabbed_64" type="radio" /><div class="tabbed-labels"><label for="__tabbed_64_1">Input [Terminal 1]</label><label for="__tabbed_64_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from nation order by n_nationkey;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>N_NATIONKEY |          N_NAME           | N_REGIONKEY |            N_COMMENT             
-------------+---------------------------+-------------+----------------------------------
           1 | canada                    |           1 | canada
           2 | united states             |           1 | united states of america
           3 | brazil                    |           2 | brasil
           4 | guyana                    |           2 | guyana
           5 | venezuela                 |           2 | venezuela
           6 | united kingdom            |           3 | united kingdom
           7 | portugal                  |           3 | portugal
           8 | united arab emirates      |           3 | al imarat al arabiyah multahidah
           9 | south africa              |           3 | south africa
          10 | australia                 |           4 | australia
          11 | japan                     |           4 | nippon
          12 | macau                     |           4 | aomen
          13 | hong kong                 |           4 | xianggang
          14 | new zealand               |           4 | new zealand
          15 | andorra                   |           2 | andorra
          16 | ascension islan           |           3 | ascension
          17 | austria                   |           3 | osterreich
          18 | bahamas                   |           2 | bahamas
          19 | barbados                  |           2 | barbados
          20 | belgium                   |           3 | belqique
          21 | chile                     |           2 | chile
          22 | cuba                      |           2 | cuba
          23 | cook islands              |           4 | cook islands
          25 | ecuador                   |           2 | ecuador
          26 | falkland islands          |           3 | islas malinas
          27 | fiji                      |           4 | fiji
          28 | finland                   |           3 | suomen tasavalta
          29 | greenland                 |           1 | kalaallit nunaat
          30 | great britain             |           3 | great britian
          31 | gibraltar                 |           3 | gibraltar
          32 | hungary                   |           3 | magyarorszag
          33 | iceland                   |           3 | lyoveldio island
          34 | ireland                   |           3 | eire
          35 | isle of man               |           3 | isle of man
          36 | jamaica                   |           2 | jamaica
          37 | korea                     |           4 | han-guk
          38 | luxembourg                |           3 | luxembourg
          39 | monaco                    |           3 | monaco
(38 rows)
</code></pre></div>
</div>
</div>
</div>
<p>Now all of the new records were loaded except for the one bad row with
nation key 24.</p>
</li>
<li>
<p>Even though the <code>nzload</code> command received a successful message it is
        good practice to review the <code>nzload</code> log file for any problems, for
        example bad rows that are under the <code>maxErrors</code> threshold. In the
        second putty session execute the following command:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>xxxx is the ID associated to your nzload.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="65:1"><input checked="checked" id="__tabbed_65_1" name="__tabbed_65" type="radio" /><div class="tabbed-labels"><label for="__tabbed_65_1">Input [Terminal 2]</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>more NATION.ADMIN.LABDB.xxxx.nzbad
</code></pre></div>
</div>
</div>
</div>
<p>The log file should be similar to the following.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="66:1"><input checked="checked" id="__tabbed_66_1" name="__tabbed_66" type="radio" /><div class="tabbed-labels"><label for="__tabbed_66_1">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load started at:03-Apr-20 06:12:43 PDT

  Database:         LABDB
  Schema:           ADMIN
  Tablename:        NATION
  Datafile:         /home/nz/labs/movingData/nation.del
  Host:             localhost.localdomain

Load Options

  Field delimiter:       &#39;|&#39;                NULL value:            NULL
  File Buffer Size (MB): 8                  Load Replay Region (MB): 0
  Encoding:              INTERNAL           Max errors:            10
  Skip records:          0                  Max rows:              0
  FillRecord:            No                 Truncate String:       No
  Escape Char:           None               Accept Control Chars:  No
  Allow CR in string:    No                 Ignore Zero:           No
  Quoted data:           NO                 Require Quotes:        No

  BoolStyle:             1_0                Decimal Delimiter:     &#39;.&#39;

  Disable NFC:           No               
  Date Style:            YMD                Date Delim:            &#39;-&#39;
  DateTime Delim:        &#39; &#39;
  Time Style:            24HOUR             Time Delim:            &#39;:&#39;
  Record Delim:          &#39;\n&#39;               Meridian Delim:        &#39; &#39;
  Time extra zeros:      No                 LfInString:            False            

Found bad records

bad #: input row #(byte offset to last char examined) [field #, declaration] diagnostic, &quot;text consumed&quot;[last char examined]
----------------------------------------------------------------------------------------------------------------------------
1: 10(1) [1, INT4] expected field delimiter or end of record, &quot;2&quot;[t]

Statistics

  number of records read:      25
  number of bytes read:        607
  number of bad records:       1
  -------------------------------------------------
  number of records loaded:    24

  Elapsed Time (sec): 0.0


-----------------------------------------------------------------------------
Load completed at: 03-Apr-20 06:12:43 PDT 
=============================================================================
</code></pre></div>
</div>
</div>
</div>
<p>The main difference as compared with the example before, is that all 25
of the data records in the data source file were processed, but only 24
records were loaded because there was one bad record in the data source
file.</p>
<p>Correct the bad row and load it into the <code>NATION</code> table. There are couple
options you could use. One option is to extract the bad row from the
original data source file and create a new data source file with the
correct record. However, this task could be tedious when dealing with
large data source files and potentially many bad records. The other
option, which is more appropriate, is to use the bad log file. All of
the bad records that cannot be loaded into the table are placed in the
bad log file. In the second session use vi to open and edit the
nation.bad file and change the '2t' to '24' in the first field.</p>
<p>The vi editor has two modes, a command mode used to save files, quit the
editor etc. and an insert mode. Initially you will be in the command
mode. To change the file, you need to switch into the insert mode by
pressing "i". The editor will show an <code>-- INSERT --</code> at the bottom of the
screen. Note: you can use <code>gedit</code> from the VM desktop (<code>gedit nation.bad</code>)</p>
<div class="tabbed-set tabbed-alternate" data-tabs="67:2"><input checked="checked" id="__tabbed_67_1" name="__tabbed_67" type="radio" /><input id="__tabbed_67_2" name="__tabbed_67" type="radio" /><div class="tabbed-labels"><label for="__tabbed_67_1">Input [Terminal 2]</label><label for="__tabbed_67_2">Output before changes</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>vi nation.bad
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>2t|denmark|3|Denmark
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>You can now use the cursor keys to navigate. Change the first two
         chars of the bad row from 2t to 24. Your screen should look like the
         following:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="68:1"><input checked="checked" id="__tabbed_68_1" name="__tabbed_68" type="radio" /><div class="tabbed-labels"><label for="__tabbed_68_1">Output after changes</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>24|denmark|3|Denmark


-- INSERT --
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>To save the changes, press <code>Esc</code> to switch back into command mode.
         You should see that the <code>-- INSERT --</code> string at the bottom of the
         screen vanishes. Enter :wq! and press enter to write the file, and
         quit the editor.</p>
</li>
<li>
<p>After the nation.bad file has modified to correct the record, issue
         a <code>nzload</code> to load the modified nation.bad file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="69:2"><input checked="checked" id="__tabbed_69_1" name="__tabbed_69" type="radio" /><input id="__tabbed_69_2" name="__tabbed_69" type="radio" /><div class="tabbed-labels"><label for="__tabbed_69_1">Input [Terminal 2]</label><label for="__tabbed_69_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>nzload -db labdb -u labadmin -pw password -t nation -df nation.bad -delimiter &#39;|&#39;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>Load session of table &#39;NATION&#39; completed successfully
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the new row has been loaded into the table:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="70:2"><input checked="checked" id="__tabbed_70_1" name="__tabbed_70" type="radio" /><input id="__tabbed_70_2" name="__tabbed_70" type="radio" /><div class="tabbed-labels"><label for="__tabbed_70_1">Input [Terminal 1]</label><label for="__tabbed_70_2">Output</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>select * from nation order by n_nationkey;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>N_NATIONKEY |          N_NAME           | N_REGIONKEY |            N_COMMENT             
-------------+---------------------------+-------------+----------------------------------
           1 | canada                    |           1 | canada
           2 | united states             |           1 | united states of america
           3 | brazil                    |           2 | brasil
           4 | guyana                    |           2 | guyana
           5 | venezuela                 |           2 | venezuela
           6 | united kingdom            |           3 | united kingdom
           7 | portugal                  |           3 | portugal
           8 | united arab emirates      |           3 | al imarat al arabiyah multahidah
           9 | south africa              |           3 | south africa
          10 | australia                 |           4 | australia
          11 | japan                     |           4 | nippon
          12 | macau                     |           4 | aomen
          13 | hong kong                 |           4 | xianggang
          14 | new zealand               |           4 | new zealand
          15 | andorra                   |           2 | andorra
          16 | ascension islan           |           3 | ascension
          17 | austria                   |           3 | osterreich
          18 | bahamas                   |           2 | bahamas
          19 | barbados                  |           2 | barbados
          20 | belgium                   |           3 | belqique
          21 | chile                     |           2 | chile
          22 | cuba                      |           2 | cuba
          23 | cook islands              |           4 | cook islands
     ***  24 | denmark                   |           3 | denmark
          25 | ecuador                   |           2 | ecuador
          26 | falkland islands          |           3 | islas malinas
          27 | fiji                      |           4 | fiji
          28 | finland                   |           3 | suomen tasavalta
          29 | greenland                 |           1 | kalaallit nunaat
          30 | great britain             |           3 | great britian
          31 | gibraltar                 |           3 | gibraltar
          32 | hungary                   |           3 | magyarorszag
          33 | iceland                   |           3 | lyoveldio island
          34 | ireland                   |           3 | eire
          35 | isle of man               |           3 | isle of man
          36 | jamaica                   |           2 | jamaica
          37 | korea                     |           4 | han-guk
          38 | luxembourg                |           3 | luxembourg
          39 | monaco                    |           3 | monaco
(39 rows)
</code></pre></div>
</div>
</div>
</div>
<p>The row with <code>***</code> denotes the new row that was added to the table,
which was the bad record you corrected.</p>
</li>
</ol>
<div class="admonition success">
<p class="admonition-title">Congratulations on finishing the chapter!</p>
<p>Congratulations you have completed the lab.</p>
</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../nz-04-Database-Admin/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Database Administration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Database Administration
            </div>
          </div>
        </a>
      
      
        
        <a href="../nz-06-BNR/" class="md-footer__link md-footer__link--next" aria-label="Next: Backup and Restore" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Backup and Restore
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 IBM
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>